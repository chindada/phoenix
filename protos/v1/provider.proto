syntax = "proto3";
package v1;
option go_package = "phoenix/processor/pkg/pb";

// Trading account information including account type, person ID, broker ID, account ID, and signed status.
message Account {
  string account_type = 1;
  string person_id    = 2;
  string broker_id    = 3;
  string account_id   = 4;
  bool   signed       = 5;
  string username     = 6;
}

// Detailed contract information for various instruments like stocks, futures, options, and indices.
message Contract {
  string security_type = 1;
  string code          = 2;
  string symbol        = 3;
  string exchange      = 4;
  string name          = 5;
  string currency      = 6;
  double limit_up      = 7;
  double limit_down    = 8;
  double reference     = 9;
  string update_date   = 10;
  string day_trade     = 11;
}

// Trading order details including action, price, quantity, and order type.
message Order {
  string  action       = 1;
  double  price        = 2;
  int64   quantity     = 3;
  string  price_type   = 4;
  string  order_type   = 5;
  string  order_lot    = 6;
  string  order_cond   = 7;
  string  id           = 8;
  string  seqno        = 9;
  string  ordno        = 10;
  Account account      = 11;
  string  custom_field = 12;
}

// Information about placed trading orders and their execution status.
message Trade {
  string   id                 = 1; // Order ID
  string   status             = 2; // e.g., PendingSubmit, Filled
  string   status_code        = 3;
  int64    order_ts           = 4;
  string   msg                = 5;
  double   price              = 6;
  int64    quantity           = 7;
  int64    filled_quantity    = 8;
  int64    cancelled_quantity = 9;
  string   ordno              = 10;
  Contract contract           = 11;
  Order    order              = 12;
}



// Real-time or historical tick data for a contract, including price and volume.
message Tick {
  string code               = 1;
  string datetime           = 2;
  double open               = 3;
  double avg_price          = 4;
  double close              = 5;
  double high               = 6;
  double low                = 7;
  double amount             = 8;
  double total_amount       = 9;
  int64  volume             = 10;
  int64  total_volume       = 11;
  int32  tick_type          = 12;
  int32  chg_type           = 13;
  double price_chg          = 14;
  double pct_chg            = 15;
  int64  bid_side_total_vol = 16;
  int64  ask_side_total_vol = 17;
  bool   simtrade           = 18;
}

// Historical candlestick (K-bar) data including open, high, low, close prices, and volume.
message Kbar {
  int64  ts     = 1;
  double open   = 2;
  double high   = 3;
  double low    = 4;
  double close  = 5;
  int64  volume = 6;
  double amount = 7;
}

// Real-time market snapshot for a contract, providing a summary of current market conditions.
message Snapshot {
  int64  ts                   = 1;
  string code                 = 2;
  string exchange             = 3;
  double open                 = 4;
  double high                 = 5;
  double low                  = 6;
  double close                = 7;
  double average_price        = 8;
  int64  volume               = 9;
  int64  total_volume         = 10;
  double amount               = 11;
  double total_amount         = 12;
  double price_change         = 13;
  double price_change_percent = 14;
  double buy_price            = 15;
  int64  buy_volume           = 16;
  double sell_price           = 17;
  int64  sell_volume          = 18;
}

// Realized profit and loss for a specific trade or period.
message ProfitLoss {
  int64  id       = 1;
  string code     = 2;
  string seqno    = 3;
  string dseq     = 4;
  int64  quantity = 5;
  double price    = 6;
  double pnl      = 7;
  double pr_ratio = 8;
  string cond     = 9;
  string date     = 10;
}

// Stock account settlement details, including date and amount.
message Settlement {
  string date   = 1;
  double amount = 2;
  string t_time = 3; // "T" or "T+1" etc, renamed to avoid conflict
}

// Unrealized gain or loss for currently held positions.
message Position {
  int64  id         = 1;
  string code       = 2;
  string direction  = 3;
  int64  quantity   = 4;
  double price      = 5;
  double last_price = 6;
  double pnl        = 7;
  string cond       = 8;
  string order_type = 9; // e.g., ROD
  string price_type = 10; // e.g., LMT
}

// Service Definition
// ShioajiProvider service provides an interface for trading and market data access.
service ShioajiProvider {
  // Authenticates the user and establishes a connection with the Shioaji API.
  rpc Login (LoginRequest) returns (LoginResponse) {}

  // Retrieves all available trading accounts for the logged-in user.
  rpc ListAccounts (Empty) returns (ListAccountsResponse) {}

  // Queries the current balance for the default stock account.
  rpc GetAccountBalance (Empty) returns (AccountBalanceResponse) {}

  // Retrieves stock account settlement details.
  rpc ListSettlements (Empty) returns (ListSettlementsResponse) {}

  // Queries realized profit and loss for a specified date range.
  rpc ListProfitLoss (ListProfitLossRequest) returns (ListProfitLossResponse) {}

  // Retrieves current unrealized positions and their profit/loss.
  rpc ListPositions (Empty) returns (ListPositionsResponse) {}

  // Submits a new trading order for a specific contract.
  rpc PlaceOrder (PlaceOrderRequest) returns (TradeResponse) {}

  // Modifies the price or quantity of an existing active order.
  rpc UpdateOrder (UpdateOrderRequest) returns (TradeResponse) {}

  // Requests the cancellation of an existing active order.
  rpc CancelOrder (CancelOrderRequest) returns (TradeResponse) {}

  // Lists all active trades and their statuses.
  rpc ListTrades (Empty) returns (ListTradesResponse) {}

  // Forces an update of order and trade statuses for the current session.
  rpc UpdateStatus (Empty) returns (Empty) {}

  // Retrieves historical tick data for a contract.
  rpc GetTicks (GetTicksRequest) returns (GetTicksResponse) {}

  // Retrieves historical candlestick (K-bar) data for a contract.
  rpc GetKbars (GetKbarsRequest) returns (GetKbarsResponse) {}

  // Retrieves current market snapshots for one or more contracts.
  rpc GetSnapshots (GetSnapshotsRequest) returns (GetSnapshotsResponse) {}

  // Subscribes to real-time market data (ticks or quotes) for a contract.
  rpc SubscribeQuote (SubscribeQuoteRequest) returns (Empty) {}

  // Unsubscribes from real-time market data updates for a contract.
  rpc UnsubscribeQuote (UnsubscribeQuoteRequest) returns (Empty) {}
}

// Request/Response Messages

message Empty {}

// Request message for Login method.
message LoginRequest {
  string person_id  = 1;
  string passwd     = 2;
  string api_key    = 3;
  string secret_key = 4;
}

// Response message for Login method.
message LoginResponse {
  bool   success = 1;
  string message = 2;
}

// Response message for ListAccounts method.
message ListAccountsResponse {
  repeated Account accounts = 1;
}

// Response message for GetAccountBalance method.
message AccountBalanceResponse {
  double balance  = 1;
  string currency = 2;
}

// Response message for ListSettlements method.
message ListSettlementsResponse {
  repeated Settlement settlements = 1;
}

// Request message for ListProfitLoss method.
message ListProfitLossRequest {
  string begin_date = 1;
  string end_date   = 2;
}

// Response message for ListProfitLoss method.
message ListProfitLossResponse {
  repeated ProfitLoss profit_loss = 1;
}

// Response message for ListPositions method.
message ListPositionsResponse {
  repeated Position positions = 1;
}

// Request message for PlaceOrder method.
message PlaceOrderRequest {
  string contract_code          = 1;
  string contract_security_type = 2; // e.g., "STK", "FUT"
  string action                 = 3; // "Buy", "Sell"
  double price                  = 4;
  int64  quantity               = 5;
  string price_type             = 6; // "LMT", "MKT"
  string order_type             = 7; // "ROD", "IOC", "FOK"
  string order_lot              = 8; // "Common", "IntradayOdd"
  string account_id             = 9; // Optional, to specify account
}

// Request message for UpdateOrder method.
message UpdateOrderRequest {
  string trade_id = 1;
  double price    = 2;
  int64  quantity = 3;
}

// Request message for CancelOrder method.
message CancelOrderRequest {
  string trade_id = 1;
}

// Response message for PlaceOrder, UpdateOrder, and CancelOrder methods.
message TradeResponse {
  Trade trade = 1;
}

// Response message for ListTrades method.
message ListTradesResponse {
  repeated Trade trades = 1;
}

// Request message for GetTicks method.
message GetTicksRequest {
  string contract_code          = 1;
  string contract_security_type = 2;
  string date                   = 3;
}

// Response message for GetTicks method.
message GetTicksResponse {
  repeated Tick ticks = 1;
}

// Request message for GetKbars method.
message GetKbarsRequest {
  string contract_code          = 1;
  string contract_security_type = 2;
  string start_date             = 3;
  string end_date               = 4;
}

// Response message for GetKbars method.
message GetKbarsResponse {
  repeated Kbar kbars = 1;
}

// Request message for GetSnapshots method.
message GetSnapshotsRequest {
  repeated string contract_codes = 1;
}

// Response message for GetSnapshots method.
message GetSnapshotsResponse {
  repeated Snapshot snapshots = 1;
}

// Request message for SubscribeQuote method.
message SubscribeQuoteRequest {
  string contract_code          = 1;
  string contract_security_type = 2;
  string quote_type             = 3; // "tick", "bidask"
}

// Request message for UnsubscribeQuote method.
message UnsubscribeQuoteRequest {
  string contract_code          = 1;
  string contract_security_type = 2;
  string quote_type             = 3;
}
